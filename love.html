<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta property="og:title" content="Love Calculator‚ù§Ô∏è">
  <meta property="og:description" content="Check your love score in percentage üíò">
  <meta property="og:image" content="https://heartscore.netlify.app/heart.png">
  <meta property="og:url" content="https://heartscore.netlify.app">
  <meta property="og:type" content="website">
  <link rel="icon" href="heart.png" type="image/png">
  <title>Love Calculator</title>
  <link rel="stylesheet" href="style.css">
</head>

<body class="bg">

<div class="container center">

    <span class="heart">‚ù§Ô∏è</span>
    <span class="heart">üíñ</span>
    <span class="heart">üíï</span>
    <img src="love.png" id="image" height="200" style="position: absolute; bottom: 67%; " alt="heart">
  <div class="card glass" id="card">

    <!-- FORM -->
    <div id="form">
      <h2>üíñ Love Calculator</h2>
      <input id="fname" placeholder="Your Name">
      <input id="cname" placeholder="Your Crush üíï">
      <button class="btn" onclick="submit()">Calculate ‚ù§Ô∏è</button>
    </div>

    <!-- LOADING -->
    <div id="loader" class="hidden">
      <p>Analyzing emotions üíì</p>
      <div class="fake-bar"></div>
    </div>

    <!-- PRANK RESULT -->
    <div id="prank" class="hidden prank-result">
      <h2>You have been fooled by <span id="senderName">Your friend</span></h2>

      <p>
        Your name as well as name of your love
        has been sent to <b id="senderName2">Your friend</b>
      </p>

      <div class="emoji">üòÇ</div>

      <hr>

      <p>Register NOW to same prank on your friends</p>

      <a href="create.html"><button class="btn green" onclick="goRegister()">Register NOW</button></a>
      <div>
          <h2>How it works?</h2>
          <p>STEP 1. Register & share your link.</p>
          <p>STEP 2. Check your friend's secret crush on your secret dashboard link.</p>
      </div>
    </div>

  </div>
  <!--
  <pre style="font-size:12px;opacity:.7; position:absolute; top:93%">
  <a href="about.html">About</a>  |  <a href="privacy.html">Privacy Policy</a>  |  <a href="contact.html">Contact</a>
  </pre>
  -->
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, query, where } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyB1sYh3UGcubBmxmq70aMAURpolLBGM2_M",
  authDomain: "love-calculator-12.firebaseapp.com",
  projectId: "love-calculator-12",
  storageBucket: "love-calculator-12.firebasestorage.app",
  messagingSenderId: "707941034632",
  appId: "1:707941034632:web:7b6b5a7149b73f7e80cd3d",
  measurementId: "G-CW6SHK3C2T"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const rid = new URLSearchParams(location.search).get("rid");

if (!rid) {
  card.innerHTML = "<h3>Invalid link ‚ùå</h3>";
  throw new Error("Invalid receiver id");
}

window.submit = async () => {
  if(!fname.value || !cname.value) return alert("Fill both names");

  document.getElementById("image").classList.add("hidden");
  document.getElementById("form").classList.add("hidden");
  document.getElementById("loader").classList.remove("hidden");
  
  await addDoc(collection(db,"entries"),{
    receiverId: rid,
    friend: fname.value,
    crush: cname.value
  
  });

  const q = query(collection(db,"senders"), where("receiverId","==",rid));
  const snap = await getDocs(q);

  if (snap.empty) {
    card.innerHTML = "<h3>Link expired ‚ùå</h3>";
    return;
  }

  const sender = snap.docs[0].data().senderName;
  document.getElementById("senderName").innerText = sender;
  document.getElementById("senderName2").innerText = sender;

    setTimeout(() => {
      document.getElementById("loader").classList.add("hidden");
      document.getElementById("prank").classList.remove("hidden");
    }, 600);
  }
  
</script>

</body>
</html>
