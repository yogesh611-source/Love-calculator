<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta property="og:title" content="Love Calculatorâ¤ï¸">
<meta property="og:description" content="Check your love score in percentage ğŸ’˜">
<meta property="og:image" content="https://heartscore.netlify.app/heart.png">
<meta property="og:url" content="https://heartscore.netlify.app">
<meta property="og:type" content="website">
<title>Dashboard</title>
<link rel="icon" type="image/png" href="heart.png">
<link rel="stylesheet" href="style.css">
</head>

<body class="bg">
<!-- Loader -->
<div id="loader1" class="loader1">
  <div class="spinner"></div>
  <p>Generating link...</p>
</div>

<div class="dashboard-center">

  <h2 class="welcome">Welcome ğŸ‘‹</h2>

  <!-- SHARE SECTION -->
  <div class="card share-card">
    <p><b>ğŸ”— Your Share Link</b></p>

    <div class="copy-row">
      <input id="shareLink" readonly>
      <button class="copy-btn" onclick="copyText('shareLink')">Copy</button>
    </div>
    <div id="toast" class="toast hidden">Copied âœ…</div>

    <button class="wa-btn" onclick="shareWhatsApp()">Share on WhatsApp status</button>
  </div>

  <!-- RESULT TABLE -->
  <div class="card">
    <h3>ğŸ’Œ Received Entries</h3>

    <table id="table">
      <tr>
        <th>Friend</th>
        <th>Crush</th>
        
      </tr>
      <tr>
        <td colspan="2" class="empty">No entries yet ğŸ˜…</td>
      </tr>
    </table>
  </div>
  <!--Dashboard link  -->
<br>
  <div class="card" style="overflow-wrap: break-word">
    <h3>Take screenshot of your secret dashboard link</h3>
      <p id="dashlink">Copy url of this page.</p>
  </div>
  
  <hr>
  <pre style="font-size:12px;opacity:.7; position:fixed; top:94%">
  <a href="about.html">About</a>  |  <a href="privacy.html">Privacy Policy</a>  |  <a href="contact.html">Contact</a>
  </pre>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, getDocs, query, where } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyB1sYh3UGcubBmxmq70aMAURpolLBGM2_M",
  authDomain: "love-calculator-12.firebaseapp.com",
  projectId: "love-calculator-12",
  storageBucket: "love-calculator-12.firebasestorage.app",
  messagingSenderId: "707941034632",
  appId: "1:707941034632:web:7b6b5a7149b73f7e80cd3d",
  measurementId: "G-CW6SHK3C2T"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const sid = new URLSearchParams(location.search).get("sid");


window.shareWhatsApp = function () {
  const link = document.getElementById("shareLink").value;
  const msg = `Calculate your â¤ï¸ *LOVE Percentage* â¤ï¸ using this *REAL and TRUSTED LOVE CALCULATOR* 
ğŸ˜ğŸ‘¨â€â¤ï¸â€ğŸ‘¨ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘¨â€â¤ï¸â€ğŸ‘¨ğŸ˜\n${link}`;
  window.open("https://wa.me/?text=" + encodeURIComponent(msg));
};

// ğŸ” Load sender
const senderSnap = await getDocs(
  query(collection(db,"senders"), where("dashboardId","==",sid))
);

if (senderSnap.empty) {
  document.getElementById("table").innerHTML =
    "<tr><td colspan='2'>Invalid dashboard âŒ</td></tr>";
  throw new Error("Invalid SID");
}

const data = senderSnap.docs[0].data();
document.querySelector(".welcome").innerText =
  "Welcome, " + data.senderName + " ğŸ‘‹";

// Set share link
document.getElementById("shareLink").value =
  location.origin + "/love.html?rid=" + data.receiverId;
//dashboard link 
  document.getElementById("dashlink").innerHTML= location.origin + "/dashboard.html?sid=" + data.dashboardId ;

// Load entries
const entriesSnap = await getDocs(
  query(collection(db,"entries"), where("receiverId","==",data.receiverId))
);

if (!entriesSnap.empty) {
  document.querySelector(".empty")?.remove();


entriesSnap.forEach(d=>{
  const tr = document.createElement("tr");
  tr.innerHTML = `
    <td>${d.data().friend}</td>
    <td>${d.data().crush}</td>
    
  `;
  document.getElementById("table").appendChild(tr);
});
  }
document.getElementById("loader1").classList.add("hidden");
</script>
<script>
  function copyText(id) {
  const el = document.getElementById(id);
  navigator.clipboard.writeText(el.value);
  showToast("Copied âœ…");
  }

function showToast(msg) {
  const t = document.getElementById("toast");
  t.innerText = msg;
  t.classList.remove("hidden");
  setTimeout(() => t.classList.add("hidden"), 2000);
  }
</script>
<script async="async" data-cfasync="false" src="https://pl28459265.effectivegatecpm.com/0b872ecf54f4efa0ca66600c0bfdc241/invoke.js"></script>
<div id="container-0b872ecf54f4efa0ca66600c0bfdc241"></div>
</body>
</html>
